---
title: 02.渲染管线
date: 2024-05-26
cover: img/graphic/graphic-base.jpg
categories:
 - 图形学
tags:
 - 图形学
 - 渲染管线
description: 了解GPU渲染流程
---

## 渲染管线也叫渲染流水线

整体步骤包括：
顶点处理
三角形处理
光栅化
片元处理
帧缓冲区操作

应用阶段：
即软件应用阶段，cpu主导，由开发者自由处理
应用阶段任务： 输入需要渲染的图元
图元：绘制到屏幕上的几何体的最小单位

### 渲染流程：
1.准备渲染的场景
2.调整角度，放置相机
3.渲染相机视角内的几何体

### 顶点处理：
顶点数据包含顶点坐标，uv，法线，颜色等等，将顶点坐标从本地空间变换到屏幕空间的过程成为顶点处理阶段

本地空间 - Modeling Transformation -> 世界空间 - Viewing Transformation -> 视图空间 - Projection Transformation -> 裁剪空间

### Vertex Shder(顶点着色器)
shader 一小段用来操作GPU的脚本语言
当前的可渲染管线提供了语言编写的部分

### local Space -> View Space
物体本身所处的坐标系，这个坐标系的空间成为本地空间，相机拍照时相机会以相机为原点建立一个坐标系，该坐标系成为视图空间，本地空间的物体通过模型转换和视图转换变换到视图空间

### View Space -> Clip Space
投影阶段会将相机的视角的视椎体压缩成一个立方体，立方体内部的图元会进入下一阶段，而立方体外的图元会被裁减掉
从本地空间到裁剪空间的过程成为MVP变换
该阶段主要是进行一些顶点操作

从裁剪空间出来之后，GPU对视椎体进行透视出发，转换到NDC(标准设备空间坐标)中，将立方体的视椎变为xyz在-1 到 1 之间的标准立方体，建立标准坐标系

从NDC中出来之后通过视口映射(Viewport Mapping)将xy坐标根据屏幕宽高进行相应的平移和缩放，z轴不做变换

### 顶点处理完之后进入三角形处理阶段
这一阶段主要将顶点组装成面： 首先通过图元装配（Primitive Assembly）将顶点组装成线或者三角形，然后进行面的剔除工作（Face Culling）,比如背面剔除，会将前面保留后面剔除

### 光栅化阶段
光栅化的主要工作就是生成像素
首先需要计算那些像素需要被覆盖，在Vertex Shader 中存在着顶点的相关数据，所以可以通过插值的方式计算出三角形边上的点的数据，通过边的信息，判断是否生成像素，主要方式是查看像素中心点是否被三角形覆盖来进行覆盖

### 片元处理阶段
Fragment Shader （第二个可编程渲染阶段的阶段）

逐片元的着色
有了顶点的颜色之后，通过对顶点之间像素颜色进行插值，对三角形覆盖的区域进行着色处理，通过对顶点进行插值之后得到顶点连线覆盖像素的颜色值，有了连线的顶点 信息和颜色值，就可以在水平方向继续插值，从而完成整个片元的着色
每一个片元都会执行一次fragment shader

对着色的像素进行输出合并，经过一系列测试，然后和已经在帧缓冲区中的颜色进行混合，再写入帧缓冲区中，但是只要有一个测试没有通过这个像素就会被舍弃

### 裁剪测试： 设置裁剪区，不在裁剪区中的像素会被舍弃
模板测试：

深度测试： 与物体的绘制顺序有关，先绘制的像素会被后绘制的像素覆盖

深度缓冲区，模板缓冲区，颜色缓冲区，统称为帧缓冲区
