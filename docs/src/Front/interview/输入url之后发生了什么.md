---
title: 输入url之后发生了什么
date: 2024-05-26
cover: img/front/interview.jpg
categories:
 - 前端
tags:
 - 面试真题
description: 
---


当我们在浏览器输入url之后，页面开始转圈，然后浏览器给我们呈现了相应的页面，这个过程有的时间长有的时间短。那么这个等待的过程中到底发生了什么呢？现在来探索一下

## 1、DNS解析

当我们敲下回车的那一刻，浏览器就开始对这个url进行解析，因为我们知道，如果要建立连接，必须要知道服务器的ip才可以，所以第一步就是解析url，也叫DNS（域名系统）解析。

1.  为了尽快完成解析，浏览器会首先查找我们的hosts文件，看有没有域名对应的ip，如果有的话就直接使用。
2.  如果本地没有相应的域名的话，浏览器会发送请求到本地的DMS服务器。本地DNS服务器一般都是由网络供应商来提供的，比如中国移动。
3.  本地DNS收到请求之后，也会先查看本地的缓存中有没有对应的ip。如果有的话直接给客户端，如果没有就要到跟DNS服务器去查询。
4.  根DNS服务器不会缓存域名和ip的对应关系，而会存着域名和对应域名的服务器地址，当域名到根DNS服务器时，服务器会解析该域名，然后给本地DNS一个域名服务器的地址，告诉本地DNS要去这里查找。
5.  本地DNS拿到域名服务器地址之后，去请求该服务器，域名服务器就会返回相应的ip给本地DNS，本地DNS拿到这个服务器之后，会跟相应域名做一个关联，然后缓存到本地，之后把该ip返回给浏览器

## 2、建立TCP连接

当浏览器拿到一个具体的ip之后，就相当于我们打电话终于拿到了正确的电话号码。可以拨号了。拨号的过程，在网络上叫做建立连接。\
通常浏览器和服务器建立的都是TCP连接。要建立连接，需要三次握手。

> 三次握手流程
>
> 1.  第一次握手，客户端给服务器端发送请求连接的信息（SYN数据包）
> 2.  第二次握手，服务器端相应连接的请求并返回SYN/ACK数据包
> 3.  第三次握手，客户端确认连接的请求，并返回ACK数据包。至此连接成功

## 3、浏览器发送http请求

成功建立连接之后，浏览器会通过http协议向服务器发送获取数据的请求，请求通常包含四部分

> 1.  请求行：包含请求的url，请求方法，请求的服务器远程地址
> 2.  请求头：请求头用来告知服务器请求的客户端的信息
> 3.  空行：告诉服务器，请求头已经结束
> 4.  请求数据：用在post请求中，即post请求的请求体

## 4、断开http请求

为了避免客户端和浏览器的资源占用和消耗，当不再有请求和响应之后，双方可以断开TCP连接。断开TCP连接时需要四次挥手，四次回收的过程

> 1.  客户端发送关闭连接的请求，并传递FIN数据包
> 2.  服务器响应请求，并回传ACK数据包
> 3.  回传ACK数据包之后，服务器需要再次确定关闭连接的请求。并通知客户端，发送给客户端FIN数据包。
> 4.  客户端确认关闭连接，整个tcp连接关闭

### 5、浏览器解析资源

浏览器获取到HTML、CSS、js等资源，通过一定的规则进行解析，首先HTML会被解析成一颗DOM树，css会解析成一颗规则树。根绝DOM树和规则树生成一颗渲染树。

## 6、浏览器渲染页面

渲染树生成之后，浏览器会根据盒模型，格式化上下文等规则进行渲染，将渲染树渲染成常见的页面。

***over***