---
title: 输入url之后发生了什么
date: 2024-05-26
cover: img/front/interview.jpg
categories:
 - 前端
tags:
 - 面试真题
description: 
---


当我们在浏览器输入url之后，页面开始转圈，然后浏览器给我们呈现了相应的页面，这个过程有的时间长有的时间短。那么这个等待的过程中到底发生了什么呢？现在来探索一下

## 1. URL检测： 纠错 / 补全

在用户输入URL的时候，比如输入的是`www.baidu.com`，该字符串并不是一个完整的URL（缺少协议），但是浏览器依然会找到百度的网页，是因为在输入URL后，浏览器会自动的将其补全。

## 2. DNS解析

DNS解析，即域名系统（Domain Name System）解析，是将人类可以看懂的域名（如`www.baidu.com`）转换成计算机网络中使用的IP地址（如`14.215.177.38`）的过程。  

DNS解析是一个分层的，递归的过程，会经历以下几个步骤：

1. 浏览器缓存查找：查看浏览器是否有缓存的，未过期的域名，如果有就可以直接使用。  
2. 系统缓存查找：查找系统中的DNS缓存，在windows中可以通过`ipconfig /displaydns`命令查看系统缓存中的域名解析。 
3. hosts文件查找：从本地的HOST文件中查找有没有对应的域名映射。  
4. 本地DNS服务器查询  
5. 根DNS服务器查询  
6. 顶级域名服务器查询  
7. 权威域名服务器查询

## 3. TCP连接

当查找到对应的IP之后，需要通过TCP协议与服务器建立连接，TCP（Transmission Control Protocol）即传输控制协议，是一种面向连接的、可靠的、基于字节流的传输层通信协议。 

TCP连接需要经历三次握手： 
1.  客户端发送SYN（同步）数据包给服务器，请求建立连接。
2.  服务器收到SYN数据包后，发送SYN/ACK（同步/确认）数据包给客户端，确认连接请求。  
3.  客户端收到SYN/ACK数据包后，发送ACK（确认）数据包给服务器，确认连接。  

三次握手可以确保客户端和服务端都能确认对方的发送和接受功能正常，保证了数据传输的可靠性

## 4. 浏览器发送HTTP请求

浏览器首先需要准备请求的信息（报文），包括请求头(cookie 等)和请求体。

准备好请求信息后，就会通过GET，POST等方法发送请求到服务器。

## 5. 服务器处理请求

服务器接收到请求后，会根据请求的URL和HTTP方法进行处理，并将响应内容返回给客户端。  

## 6. 浏览器接收并处理响应

### 处理响应头  
- set-cookie: 服务器设置的cookie信息，浏览器会将其保存到本地，下次请求时会自动携带。  
- content-type: 表示响应的内容类型，决定了后续内容浏览器如何解析  
- connection: 是否保持连接，有些内容比较大，可能会需要保持连接，减少连接次数
- 状态码: 该次相应的状态码，如200表示成功，404表示未找到  
- 缓存: 浏览器会根据缓存策略来决定是否使用缓存，减少网络请求

### 处理响应体

在浏览器接受响应体的时候，浏览器并不会一次性接收完之后再处理，而是会边接收边处理。（以下后续渲染工作，都是针对html来展开）  

## 7. 渲染页面

由于在浏览器中，每一个标签页只有一个主要的渲染线程，而所有的渲染工作，以及js代码的解析和执行（js引擎的工作）都在这个线程中进行。所以在这个线程中需要根据一定的顺序来执行每一项工作（渲染管线）  
- 解析文档：该步骤的主要目的就是生成DOM树和CSSOM树。其中会包括
  - 预处理线程：在解析HTML文档是，提前加兹安文档中引用的各工种资源，如脚本、样式等。预处理线程中也会对资源加载顺序进行优化，保证用户体验
  - 资源加载：该线程会加载文档中引用的资源，如图片、脚本、样式等。
  - 资源描述符：该线程会解析文档中的资源描述符，如meta标签、link标签等。    
- 样式计算：这一步会将css规则应用到DOM树上，计算出每个节点最终的样式  
- layout布局: 计算每个元素的尺寸和位置
- layer分层: 该步骤会将页面中的元素按照一定的规则进行分层，以便后续的渲染
- paint绘制: 将需要绘制的内容转换成像素
------ 渲染线程结束，可以执行后续任务 ------
------ 合成线程开始工作 ------

- tiles分块: 根据视口大小，将页面分为多个块。
- 栅格化: 将每个块中的内容转换成位图。
- 绘制: 将位图绘制到屏幕上。

## 8. 断开TCP连接

当所有数据都已经发送完之后，有connection来决定是否要关闭，如果connection的值是keep-alive，那么就会保持链接，如果不是则会断开链接。

断开TCP连接时需要四次挥手：

1.  客户端发送关闭连接的请求，并传递FIN数据包
2.  服务器响应请求，并回传ACK数据包
3.  回传ACK数据包
4.  客户端发送关闭连接的请求，并传递FIN数据包
5.  服务器响应请求，并回传ACK数据包
6.  回传ACK数据包

***over***